"use strict";(self.webpackChunkaiconfig_docs=self.webpackChunkaiconfig_docs||[]).push([[784],{9870:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>s,metadata:()=>u,toc:()=>g});var t=n(5893),l=n(1151),i=n(4866),r=n(5162),o=n(4883);const s={sidebar_position:7},c="Tracing and Monitoring",u={id:"overview/monitoring-aiconfig",title:"Tracing and Monitoring",description:"Event callbacks provide in-depth tracing of aiconfig operations, and allow hooks for debuggability and monitoring.",source:"@site/docs/overview/monitoring-aiconfig.md",sourceDirName:"overview",slug:"/overview/monitoring-aiconfig",permalink:"/docs/overview/monitoring-aiconfig",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"docSidebar",previous:{title:"Run a Prompt",permalink:"/docs/overview/run-aiconfig"},next:{title:"Supported Models",permalink:"/docs/overview/model-parsers"}},d={},g=[{value:"Creating custom callbacks",id:"creating-custom-callbacks",level:2},{value:"Registering Callbacks",id:"registering-callbacks",level:2},{value:"Structure of a <code>CallbackEvent</code>",id:"structure-of-a-callbackevent",level:2},{value:"Sample output:",id:"sample-output",level:3},{value:"Triggering Callbacks",id:"triggering-callbacks",level:2},{value:"Handling Callbacks with Timers",id:"handling-callbacks-with-timers",level:4},{value:"Error Handling",id:"error-handling",level:4}];function h(e){const a={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.h1,{id:"tracing-and-monitoring",children:"Tracing and Monitoring"}),"\n",(0,t.jsxs)(a.p,{children:["Event callbacks provide in-depth tracing of ",(0,t.jsx)(a.code,{children:"aiconfig"})," operations, and allow hooks for debuggability and monitoring."]}),"\n",(0,t.jsxs)(a.p,{children:["The AIConfig SDK has a ",(0,t.jsx)(a.code,{children:"CallbackManager"})," class which can be used to register callbacks that trace prompt resolution, serialization, deserialization, and model inference, as well as intermediate steps."]}),"\n",(0,t.jsx)(a.p,{children:"This lets you get a stack trace of what's going on under the covers, which is especially useful for complex control flow operations."}),"\n",(0,t.jsx)(a.admonition,{type:"note",children:(0,t.jsx)(a.p,{children:"Anyone can register a callback, and filter for the events you care about. You can subsequently use these callbacks to integrate with your own monitoring and observability systems."})}),"\n",(0,t.jsx)("p",{align:"center",children:(0,t.jsx)("video",{controls:!0,height:"480",width:"800",children:(0,t.jsx)("source",{src:"https://github.com/lastmile-ai/aiconfig/assets/141073967/ce909fc4-881f-40d9-9c67-78a6682b3063"})})}),"\n",(0,t.jsx)(a.h2,{id:"creating-custom-callbacks",children:"Creating custom callbacks"}),"\n",(0,t.jsx)(a.p,{children:"Custom callbacks are functions that conform to the Callback type. They receive a CallbackEvent object containing event details, and return a Promise. Here's an example of a simple logging callback:"}),"\n",(0,t.jsxs)(i.Z,{groupId:"aiconfig-language",queryString:!0,defaultValue:o.Z.defaultAIConfigLanguage,values:o.Z.aiConfigLanguages,children:[(0,t.jsx)(r.Z,{value:"python",children:(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-python",metastring:'title="app.py"',children:'from aiconfig import AIConfigRuntime, CallbackEvent, CallbackManager\n\nasync def my_custom_callback(event: CallbackEvent) -> None:\n  print(f"Event triggered: {event.name}", event)\n'})})}),(0,t.jsx)(r.Z,{value:"node",children:(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-typescript",metastring:'title="app.ts"',children:'import { Callback, CallbackEvent } from "aiconfig";\n\nconst myCustomCallback: Callback = async (event: CallbackEvent) => {\n  console.log(`Event triggered: ${event.name}`, event);\n};\n'})})})]}),"\n",(0,t.jsx)(a.h2,{id:"registering-callbacks",children:"Registering Callbacks"}),"\n",(0,t.jsx)(a.admonition,{type:"info",children:(0,t.jsxs)(a.p,{children:["By default, a CallbackManager is set up which logs all events to to ",(0,t.jsx)(a.code,{children:"aiconfig.log"}),". This is useful for local debugging."]})}),"\n",(0,t.jsxs)(i.Z,{groupId:"aiconfig-language",queryString:!0,defaultValue:o.Z.defaultAIConfigLanguage,values:o.Z.aiConfigLanguages,children:[(0,t.jsx)(r.Z,{value:"python",children:(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-python",metastring:'title="app.py"',children:'from aiconfig import AIConfigRuntime, CallbackEvent, CallbackManager\nconfig = AIConfigRuntime.load(\'aiconfig.json\')\n\nasync def my_custom_callback(event: CallbackEvent) -> None:\n  print(f"Event triggered: {event.name}", event)\n\ncallback_manager = CallbackManager([my_custom_callback])\nconfig.set_callback_manager(callback_manager)\n\nawait config.run("prompt_name")\n'})})}),(0,t.jsx)(r.Z,{value:"node",children:(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-typescript",metastring:'title="app.ts"',children:'import * as path from "path";\nimport {\n  AIConfigRuntime,\n  Callback,\n  CallbackEvent,\n  CallbackManager,\n} from "aiconfig";\n\nconst config = AIConfigRuntime.load(path.join(__dirname, "aiconfig.json"));\n\nconst myCustomCallback: Callback = async (event: CallbackEvent) => {\n  console.log(`Event triggered: ${event.name}`, event);\n};\n\nconst callbackManager = new CallbackManager([myCustomCallback]);\nconfig.setCallbackManager(callbackManager);\n\nawait config.run("prompt_name");\n'})})})]}),"\n",(0,t.jsxs)(a.h2,{id:"structure-of-a-callbackevent",children:["Structure of a ",(0,t.jsx)(a.code,{children:"CallbackEvent"})]}),"\n",(0,t.jsxs)(a.p,{children:["Each ",(0,t.jsx)(a.code,{children:"CallbackEvent"})," is an object of the CallbackEvent type, containing:"]}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.code,{children:"name"}),': The name of the event (e.g., "on_resolve_start").']}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.code,{children:"file"}),": The source file where the event is triggered"]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.code,{children:"data"}),": An object containing relevant data for the event, such as parameters or results."]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.code,{children:"ts_ns"}),": An optional timestamp in nanoseconds."]}),"\n"]}),"\n",(0,t.jsx)(a.h3,{id:"sample-output",children:"Sample output:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{children:"Event triggered: on_resolve_start\nCallbackEventModel(name='on_resolve_start', file='/Users/John/Projects/aiconfig/python/src/aiconfig/Config.py', data={'prompt_name': 'get_activities', 'params': None}, ts_ns=1700094936363867000)\n"})}),"\n",(0,t.jsx)(a.h2,{id:"triggering-callbacks",children:"Triggering Callbacks"}),"\n",(0,t.jsx)(a.p,{children:"Callbacks are automatically triggered at specific points in the AIConfigRuntime flow. For example, when the resolve method is called on an AIConfigRuntime instance, it triggers on_resolve_start and on_resolve_end events, which are then passed to the CallbackManager to execute any associated callbacks."}),"\n",(0,t.jsx)(a.p,{children:"Similarly, ModelParsers should trigger their own events when serializing, deserializing, and running inference. These events are also passed to the CallbackManager to execute any associated callbacks."}),"\n",(0,t.jsx)(a.h4,{id:"handling-callbacks-with-timers",children:"Handling Callbacks with Timers"}),"\n",(0,t.jsx)(a.p,{children:"The CallbackManager uses a timeout mechanism to ensure callbacks do not hang indefinitely. If a callback does not complete within the specified timeout, it is aborted, and an error is logged. This timeout can be adjusted in the CallbackManager constructor and defaults to 5s if not specified."}),"\n",(0,t.jsxs)(i.Z,{groupId:"aiconfig-language",queryString:!0,defaultValue:o.Z.defaultAIConfigLanguage,values:o.Z.aiConfigLanguages,children:[(0,t.jsx)(r.Z,{value:"python",children:(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-python",children:"custom_timeout = 10; # 10 seconds\ncallback_manager = CallbackManager([my_logging_callback], custom_timeout)\n"})})}),(0,t.jsx)(r.Z,{value:"node",children:(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-typescript",children:"const customTimeout = 10;\nconst callbackManager = new CallbackManager(callbacks, customTimeout);\n"})})})]}),"\n",(0,t.jsx)(a.h4,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(a.p,{children:"Custom callbacks should include error handling to manage exceptions. Errors thrown within callbacks are caught by the CallbackManager and can be logged or handled as needed."})]})}function p(e={}){const{wrapper:a}={...(0,l.a)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},4883:(e,a,n)=>{n.d(a,{Z:()=>r});var t=n(412);const l=!!t.Z.canUseDOM&&navigator.platform.startsWith("Mac"),i=!!t.Z.canUseDOM&&navigator.platform.startsWith("Win"),r={defaultOs:l?"macos":i?"windows":"linux",defaultNodePackageManager:"npm",defaultPythonPackageManager:"pip",defaultPlatform:l?"ios":"android",defaultSyntax:"functional",defaultAIConfigLanguage:"python",getDevNotesTabs:function(e){return void 0===e&&(e=["android","ios","web","windows"]),[e.includes("android")?{label:"Android",value:"android"}:void 0,e.includes("ios")?{label:"iOS",value:"ios"}:void 0,e.includes("web")?{label:"Web",value:"web"}:void 0,e.includes("windows")?{label:"Windows",value:"windows"}:void 0].filter(Boolean)},oses:[{label:"macOS",value:"macos"},{label:"Windows",value:"windows"},{label:"Linux",value:"linux"}],nodePackageManagers:[{label:"npm",value:"npm"},{label:"Yarn",value:"yarn"}],pythonPackageManagers:[{label:"pip",value:"pip"},{label:"poetry",value:"poetry"}],platforms:[{label:"Android",value:"android"},{label:"iOS",value:"ios"}],aiConfigLanguages:[{label:"Python",value:"python"},{label:"TypeScript",value:"node"}]}},5162:(e,a,n)=>{n.d(a,{Z:()=>r});n(7294);var t=n(6010);const l={tabItem:"tabItem_Ymn6"};var i=n(5893);function r(e){let{children:a,hidden:n,className:r}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,t.Z)(l.tabItem,r),hidden:n,children:a})}},4866:(e,a,n)=>{n.d(a,{Z:()=>j});var t=n(7294),l=n(6010),i=n(2466),r=n(6550),o=n(469),s=n(1980),c=n(7392),u=n(12);function d(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function g(e){const{values:a,children:n}=e;return(0,t.useMemo)((()=>{const e=a??function(e){return d(e).map((e=>{let{props:{value:a,label:n,attributes:t,default:l}}=e;return{value:a,label:n,attributes:t,default:l}}))}(n);return function(e){const a=(0,c.l)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,n])}function h(e){let{value:a,tabValues:n}=e;return n.some((e=>e.value===a))}function p(e){let{queryString:a=!1,groupId:n}=e;const l=(0,r.k6)(),i=function(e){let{queryString:a=!1,groupId:n}=e;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:a,groupId:n});return[(0,s._X)(i),(0,t.useCallback)((e=>{if(!i)return;const a=new URLSearchParams(l.location.search);a.set(i,e),l.replace({...l.location,search:a.toString()})}),[i,l])]}function m(e){const{defaultValue:a,queryString:n=!1,groupId:l}=e,i=g(e),[r,s]=(0,t.useState)((()=>function(e){let{defaultValue:a,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!h({value:a,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${a}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return a}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:a,tabValues:i}))),[c,d]=p({queryString:n,groupId:l}),[m,b]=function(e){let{groupId:a}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(a),[l,i]=(0,u.Nk)(n);return[l,(0,t.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:l}),f=(()=>{const e=c??m;return h({value:e,tabValues:i})?e:null})();(0,o.Z)((()=>{f&&s(f)}),[f]);return{selectedValue:r,selectValue:(0,t.useCallback)((e=>{if(!h({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);s(e),d(e),b(e)}),[d,b,i]),tabValues:i}}var b=n(2389);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=n(5893);function k(e){let{className:a,block:n,selectedValue:t,selectValue:r,tabValues:o}=e;const s=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.o5)(),u=e=>{const a=e.currentTarget,n=s.indexOf(a),l=o[n].value;l!==t&&(c(a),r(l))},d=e=>{let a=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=s.indexOf(e.currentTarget)+1;a=s[n]??s[0];break}case"ArrowLeft":{const n=s.indexOf(e.currentTarget)-1;a=s[n]??s[s.length-1];break}}a?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":n},a),children:o.map((e=>{let{value:a,label:n,attributes:i}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:t===a?0:-1,"aria-selected":t===a,ref:e=>s.push(e),onKeyDown:d,onClick:u,...i,className:(0,l.Z)("tabs__item",f.tabItem,i?.className,{"tabs__item--active":t===a}),children:n??a},a)}))})}function x(e){let{lazy:a,children:n,selectedValue:l}=e;const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(a){const e=i.find((e=>e.props.value===l));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:i.map(((e,a)=>(0,t.cloneElement)(e,{key:a,hidden:e.props.value!==l})))})}function y(e){const a=m(e);return(0,v.jsxs)("div",{className:(0,l.Z)("tabs-container",f.tabList),children:[(0,v.jsx)(k,{...e,...a}),(0,v.jsx)(x,{...e,...a})]})}function j(e){const a=(0,b.Z)();return(0,v.jsx)(y,{...e,children:d(e.children)},String(a))}},1151:(e,a,n)=>{n.d(a,{Z:()=>o,a:()=>r});var t=n(7294);const l={},i=t.createContext(l);function r(e){const a=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),t.createElement(i.Provider,{value:a},e.children)}}}]);